<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PropIA ‚Äî Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #07090f;
      --surface: #0f1420;
      --surface2: #161d2e;
      --border: rgba(255,255,255,0.07);
      --gold: #c9a84c;
      --gold-light: #e8c96a;
      --gold-dim: rgba(201,168,76,0.12);
      --text: #eeeae0;
      --muted: #7a8099;
      --radius: 14px;
      --success: #22c55e;
      --error: #ef4444;
      --sidebar: 240px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      min-height: 100vh;
      display: flex;
    }

    /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
    .sidebar {
      width: var(--sidebar);
      background: var(--surface);
      border-right: 1px solid var(--border);
      display: flex; flex-direction: column;
      position: fixed; top: 0; left: 0; bottom: 0;
      z-index: 100;
    }
    .sidebar-logo {
      padding: 24px 20px;
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; gap: 10px;
    }
    .sidebar-logo .icon {
      width: 36px; height: 36px;
      background: linear-gradient(135deg, var(--gold), #8a5e1e);
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px;
    }
    .sidebar-logo .name {
      font-family: 'Playfair Display', serif;
      font-size: 18px; font-weight: 700;
    }
    .sidebar-logo .name span { color: var(--gold); }

    .sidebar-nav {
      flex: 1; padding: 16px 10px;
      display: flex; flex-direction: column; gap: 4px;
    }
    .nav-section-label {
      font-size: 10px; font-weight: 600; text-transform: uppercase;
      letter-spacing: 1px; color: var(--muted);
      padding: 10px 10px 6px;
    }
    .nav-item {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 12px; border-radius: 9px;
      cursor: pointer; color: var(--muted);
      font-size: 13px; font-weight: 500;
      transition: all 0.15s; border: none; background: none;
      width: 100%; text-align: left;
    }
    .nav-item:hover { background: var(--surface2); color: var(--text); }
    .nav-item.active {
      background: var(--gold-dim);
      color: var(--gold-light); font-weight: 600;
    }
    .nav-item .nav-icon { font-size: 16px; width: 20px; text-align: center; }

    .sidebar-footer {
      padding: 16px;
      border-top: 1px solid var(--border);
    }
    .user-card {
      display: flex; align-items: center; gap: 10px;
      padding: 10px; border-radius: 9px;
      background: var(--surface2);
    }
    .user-avatar {
      width: 34px; height: 34px;
      background: linear-gradient(135deg, var(--gold), #8a5e1e);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 14px; font-weight: 700; color: var(--bg);
      flex-shrink: 0;
    }
    .user-info { flex: 1; overflow: hidden; }
    .user-name { font-size: 13px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .user-plan {
      font-size: 10px; color: var(--gold);
      text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;
    }
    .btn-logout {
      background: none; border: none; cursor: pointer;
      color: var(--muted); font-size: 16px; padding: 4px;
      transition: color 0.15s;
    }
    .btn-logout:hover { color: var(--error); }

    /* ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ */
    .main {
      margin-left: var(--sidebar);
      flex: 1;
      display: flex; flex-direction: column;
    }

    .topbar {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 18px 32px;
      display: flex; align-items: center; justify-content: space-between;
      position: sticky; top: 0; z-index: 50;
    }
    .page-title {
      font-family: 'Playfair Display', serif;
      font-size: 22px; font-weight: 700;
    }

    .usage-bar {
      display: flex; align-items: center; gap: 20px;
    }
    .usage-item { font-size: 12px; color: var(--muted); }
    .usage-item strong { color: var(--text); }
    .usage-item .used { color: var(--gold); }

    .content {
      flex: 1;
      padding: 32px;
      overflow-y: auto;
    }

    /* PANELS */
    .panel { display: none; }
    .panel.active { display: block; animation: fadeIn 0.25s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

    /* ‚îÄ‚îÄ OVERVIEW PANEL ‚îÄ‚îÄ */
    .stats-grid {
      display: grid; grid-template-columns: repeat(3, 1fr);
      gap: 16px; margin-bottom: 28px;
    }
    .stat-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 22px 24px;
    }
    .stat-label { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.6px; color: var(--muted); margin-bottom: 8px; }
    .stat-value { font-family: 'Playfair Display', serif; font-size: 36px; font-weight: 700; color: var(--gold); line-height: 1; margin-bottom: 4px; }
    .stat-sub { font-size: 12px; color: var(--muted); }

    .progress-bar-wrap { margin-top: 10px; }
    .progress-track { background: var(--surface2); border-radius: 4px; height: 5px; overflow: hidden; }
    .progress-fill { background: linear-gradient(90deg, var(--gold), #e8c96a); height: 100%; border-radius: 4px; transition: width 0.5s ease; }

    .history-table {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
    }
    .table-header {
      padding: 18px 24px;
      border-bottom: 1px solid var(--border);
      font-size: 13px; font-weight: 600; color: var(--muted);
      text-transform: uppercase; letter-spacing: 0.5px;
      display: grid; grid-template-columns: 1fr auto auto;
      gap: 16px;
    }
    .table-row {
      padding: 16px 24px;
      border-bottom: 1px solid var(--border);
      display: grid; grid-template-columns: 1fr auto auto;
      gap: 16px; align-items: center;
      font-size: 13px;
    }
    .table-row:last-child { border-bottom: none; }
    .table-row:hover { background: var(--surface2); }
    .empty-state {
      padding: 40px; text-align: center;
      color: var(--muted); font-size: 14px;
    }
    .tag {
      font-size: 10px; font-weight: 600; text-transform: uppercase;
      letter-spacing: 0.5px; padding: 4px 10px; border-radius: 20px;
    }
    .tag-gold { background: var(--gold-dim); color: var(--gold-light); }
    .tag-free { background: rgba(122,128,153,0.15); color: var(--muted); }

    /* ‚îÄ‚îÄ GENERATOR PANEL ‚îÄ‚îÄ */
    .gen-grid {
      display: grid; grid-template-columns: 1fr 1fr; gap: 24px;
    }
    @media (max-width: 900px) { .gen-grid { grid-template-columns: 1fr; } }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 28px;
    }
    .card-title {
      font-size: 12px; font-weight: 600; text-transform: uppercase;
      letter-spacing: 1px; color: var(--gold);
      margin-bottom: 22px; display: flex; align-items: center; gap: 8px;
    }
    .form-group { margin-bottom: 16px; }
    .form-group label {
      display: block; font-size: 11px; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.5px;
      color: var(--muted); margin-bottom: 7px;
    }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 9px; color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 14px; padding: 11px 14px; outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(201,168,76,0.1);
    }
    .form-group input::placeholder, .form-group textarea::placeholder { color: #3a4158; }
    .form-group select option { background: var(--surface); }
    .form-group textarea { resize: vertical; min-height: 80px; line-height: 1.5; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

    .tone-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 8px; }
    .tone-btn {
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: 8px; color: var(--muted);
      font-family: 'DM Sans', sans-serif; font-size: 12px;
      font-weight: 500; padding: 9px 6px; cursor: pointer;
      text-align: center; transition: all 0.18s;
    }
    .tone-btn:hover { border-color: var(--gold); color: var(--text); }
    .tone-btn.active { background: var(--gold-dim); border-color: var(--gold); color: var(--gold-light); font-weight: 600; }

    .btn-primary {
      width: 100%;
      background: linear-gradient(135deg, var(--gold), #9a6e20);
      border: none; border-radius: 10px;
      color: #07090f; font-family: 'DM Sans', sans-serif;
      font-size: 15px; font-weight: 700; padding: 14px;
      cursor: pointer; transition: opacity 0.2s, transform 0.1s;
      margin-top: 8px;
    }
    .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }
    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .btn-primary.is-loading .label { display: none; }
    .btn-primary.is-loading .loading { display: flex; justify-content: center; align-items: center; gap: 8px; }
    .btn-primary .loading { display: none; }

    .spinner { width: 16px; height: 16px; border: 2px solid rgba(7,9,15,0.3); border-top-color: #07090f; border-radius: 50%; animation: spin 0.7s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .alert { border-radius: 8px; padding: 12px 14px; font-size: 13px; line-height: 1.5; display: none; margin-top: 8px; }
    .alert.error   { background: rgba(239,68,68,0.1);  border: 1px solid rgba(239,68,68,0.3);  color: #fca5a5; display: block; }
    .alert.success { background: rgba(34,197,94,0.1);  border: 1px solid rgba(34,197,94,0.3);  color: #86efac; display: block; }
    .alert.upgrade { background: var(--gold-dim); border: 1px solid rgba(201,168,76,0.3); color: var(--gold-light); display: block; }

    /* OUTPUT */
    .output-wrap { grid-column: 1 / -1; display: none; }
    .output-wrap.visible { display: block; animation: fadeIn 0.3s ease; }

    .output-tabs {
      display: flex; gap: 4px;
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 10px; padding: 4px; width: fit-content; margin-bottom: 20px;
    }
    .otab {
      background: none; border: none; border-radius: 7px;
      color: var(--muted); font-family: 'DM Sans', sans-serif;
      font-size: 13px; font-weight: 500; padding: 8px 16px;
      cursor: pointer; transition: all 0.18s;
    }
    .otab.active { background: var(--gold-dim); color: var(--gold-light); font-weight: 600; }

    .otab-content { display: none; }
    .otab-content.active { display: block; animation: fadeIn 0.25s ease; }

    .output-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 28px; }
    .output-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 18px; }
    .output-label { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); }
    .btn-copy {
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: 7px; color: var(--muted);
      font-family: 'DM Sans', sans-serif; font-size: 12px;
      font-weight: 500; padding: 6px 14px; cursor: pointer; transition: all 0.18s;
    }
    .btn-copy:hover { border-color: var(--gold); color: var(--gold-light); }
    .btn-copy.copied { color: var(--success); border-color: var(--success); }
    .output-text { font-size: 14px; line-height: 1.75; white-space: pre-wrap; word-break: break-word; }
    .post-item { background: var(--surface2); border: 1px solid var(--border); border-radius: 10px; padding: 18px; margin-bottom: 14px; position: relative; }
    .post-num { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--gold); margin-bottom: 8px; }
    .post-text { font-size: 13px; line-height: 1.65; white-space: pre-wrap; }
    .post-copy { position: absolute; top: 14px; right: 14px; background: none; border: 1px solid var(--border); border-radius: 6px; color: var(--muted); font-size: 11px; padding: 4px 10px; cursor: pointer; transition: all 0.15s; }
    .post-copy:hover { border-color: var(--gold); color: var(--gold-light); }

    /* PLAN PANEL */
    .plans-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 16px; }
    @media (max-width: 1100px) { .plans-grid { grid-template-columns: repeat(2,1fr); } }
    .plan-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 28px;
      display: flex; flex-direction: column;
      position: relative; transition: border-color 0.2s;
    }
    .plan-card.current { border-color: var(--gold); }
    .plan-card.popular { border-color: rgba(42,110,245,0.4); }
    .plan-badge {
      position: absolute; top: -12px; left: 50%; transform: translateX(-50%);
      font-size: 10px; font-weight: 700; text-transform: uppercase;
      letter-spacing: 0.8px; padding: 4px 12px; border-radius: 20px;
      white-space: nowrap;
    }
    .plan-badge.gold-badge { background: var(--gold); color: var(--bg); }
    .plan-badge.blue-badge { background: #2a6ef5; color: #fff; }
    .plan-name { font-family: 'Playfair Display', serif; font-size: 20px; font-weight: 700; margin-bottom: 4px; }
    .plan-price { font-size: 32px; font-weight: 700; color: var(--gold); line-height: 1; margin-bottom: 4px; }
    .plan-price span { font-size: 14px; font-weight: 400; color: var(--muted); }
    .plan-desc { font-size: 12px; color: var(--muted); margin-bottom: 20px; line-height: 1.5; }
    .plan-features { flex: 1; display: flex; flex-direction: column; gap: 8px; margin-bottom: 24px; }
    .plan-feat { font-size: 13px; display: flex; gap: 8px; align-items: flex-start; }
    .plan-feat .check { color: var(--gold); flex-shrink: 0; }
    .plan-feat .cross { color: var(--muted); flex-shrink: 0; }
    .btn-plan {
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: 9px; color: var(--text);
      font-family: 'DM Sans', sans-serif; font-size: 14px;
      font-weight: 600; padding: 12px; cursor: pointer;
      transition: all 0.18s; text-align: center;
    }
    .btn-plan:hover { border-color: var(--gold); color: var(--gold-light); }
    .btn-plan.current { background: var(--gold-dim); border-color: var(--gold); color: var(--gold-light); cursor: default; }
    .btn-plan.upgrade-btn { background: linear-gradient(135deg, var(--gold), #9a6e20); border-color: transparent; color: var(--bg); font-weight: 700; }
    .btn-plan.upgrade-btn:hover { opacity: 0.9; }

    @media (max-width: 640px) {
      .main { margin-left: 0; }
      .sidebar { display: none; }
      .stats-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<!-- ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ -->
<div class="sidebar">
  <div class="sidebar-logo">
    <div class="icon">üè†</div>
    <div class="name">Prop<span>IA</span></div>
  </div>
  <nav class="sidebar-nav">
    <div class="nav-section-label">Principal</div>
    <button class="nav-item active" onclick="showPanel('overview',this)">
      <span class="nav-icon">üìä</span> Resumen
    </button>
    <button class="nav-item" onclick="showPanel('generator',this)">
      <span class="nav-icon">‚ú®</span> Generar Listing
    </button>
    <div class="nav-section-label" style="margin-top:8px;">Cuenta</div>
    <button class="nav-item" onclick="showPanel('plans',this)">
      <span class="nav-icon">üíé</span> Planes y Precios
    </button>
  </nav>
  <div class="sidebar-footer">
    <div class="user-card">
      <div class="user-avatar" id="userInitial">?</div>
      <div class="user-info">
        <div class="user-name" id="userName">Cargando...</div>
        <div class="user-plan" id="userPlan">free</div>
      </div>
      <button class="btn-logout" onclick="logout()" title="Cerrar sesi√≥n">‚¨°</button>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ -->
<div class="main">
  <div class="topbar">
    <div class="page-title" id="pageTitle">Resumen</div>
    <div class="usage-bar">
      <div class="usage-item">Listings: <strong><span class="used" id="topUsed">0</span>/<span id="topLimit">5</span></strong></div>
      <div class="usage-item">Plan: <strong id="topPlan">Gratis</strong></div>
    </div>
  </div>

  <div class="content">

    <!-- ‚îÄ‚îÄ OVERVIEW PANEL ‚îÄ‚îÄ -->
    <div class="panel active" id="panel-overview">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Listings Generados</div>
          <div class="stat-value" id="statUsed">0</div>
          <div class="stat-sub" id="statLimit">de 5 en tu plan Gratis</div>
          <div class="progress-bar-wrap">
            <div class="progress-track">
              <div class="progress-fill" id="statProgress" style="width:0%"></div>
            </div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Tu Plan Actual</div>
          <div class="stat-value" style="font-size:24px;padding-top:6px;" id="statPlan">Gratis</div>
          <div class="stat-sub">Renueva el pr√≥ximo mes</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Assets Generados</div>
          <div class="stat-value" id="statAssets">0</div>
          <div class="stat-sub">MLS + Posts + Email + Video</div>
        </div>
      </div>

      <div class="history-table">
        <div class="table-header">
          <div>Propiedad</div>
          <div>Tono</div>
          <div>Fecha</div>
        </div>
        <div id="historyBody">
          <div class="empty-state">
            A√∫n no has generado ning√∫n listing.<br>
            <span style="color:var(--gold);cursor:pointer;" onclick="showPanel('generator', document.querySelectorAll('.nav-item')[1])">Genera tu primer listing ‚Üí</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ GENERATOR PANEL ‚îÄ‚îÄ -->
    <div class="panel" id="panel-generator">
      <div class="gen-grid">
        <!-- FORM -->
        <div class="card">
          <div class="card-title">üìã Datos de la Propiedad</div>
          <div class="form-group">
            <label>Direcci√≥n</label>
            <input type="text" id="gAddress" placeholder="123 Oak Street, Miami, FL 33101" />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Precio</label>
              <input type="text" id="gPrice" placeholder="$450,000" />
            </div>
            <div class="form-group">
              <label>Tipo</label>
              <select id="gType">
                <option value="casa">Casa unifamiliar</option>
                <option value="condo">Condominio</option>
                <option value="townhouse">Townhouse</option>
                <option value="multifamiliar">Multifamiliar</option>
                <option value="terreno">Terreno</option>
                <option value="comercial">Comercial</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Rec√°maras</label>
              <input type="number" id="gBeds" placeholder="4" min="0" max="20" />
            </div>
            <div class="form-group">
              <label>Ba√±os</label>
              <input type="number" id="gBaths" placeholder="3" min="1" max="20" step="0.5" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Pies cuadrados</label>
              <input type="text" id="gSqft" placeholder="2,200" />
            </div>
            <div class="form-group">
              <label>A√±o de construcci√≥n</label>
              <input type="text" id="gYear" placeholder="2018" />
            </div>
          </div>
          <div class="form-group">
            <label>Caracter√≠sticas especiales</label>
            <textarea id="gFeatures" placeholder="Piscina, cocina remodelada, garage doble, vista al lago..."></textarea>
          </div>
          <div class="form-group">
            <label>Tono del contenido</label>
            <div class="tone-grid">
              <button class="tone-btn active" onclick="setTone(this,'lujoso')">‚ú® Lujoso</button>
              <button class="tone-btn" onclick="setTone(this,'familiar')">üë®‚Äçüë©‚Äçüëß Familiar</button>
              <button class="tone-btn" onclick="setTone(this,'inversionista')">üìà Inversionista</button>
              <button class="tone-btn" onclick="setTone(this,'moderno')">üèôÔ∏è Moderno</button>
              <button class="tone-btn" onclick="setTone(this,'urgente')">‚ö° Urgente</button>
              <button class="tone-btn" onclick="setTone(this,'emocional')">‚ù§Ô∏è Emocional</button>
            </div>
          </div>
          <button class="btn-primary" id="genBtn" onclick="generateListing()">
            <span class="label">‚ú® Generar con IA</span>
            <span class="loading"><span class="spinner"></span> Generando...</span>
          </button>
          <div id="genAlert"></div>
        </div>

        <!-- INFO CARD -->
        <div class="card" style="align-self:start;">
          <div class="card-title">üöÄ ¬øQu√© genera la IA?</div>
          <div style="display:flex;flex-direction:column;gap:16px;">
            <div style="display:flex;gap:12px;">
              <div style="font-size:20px;">üìù</div>
              <div>
                <div style="font-size:13px;font-weight:600;margin-bottom:3px;">Descripci√≥n MLS</div>
                <div style="font-size:12px;color:var(--muted);line-height:1.5;">150-200 palabras profesionales listas para el MLS</div>
              </div>
            </div>
            <div style="display:flex;gap:12px;">
              <div style="font-size:20px;">üì±</div>
              <div>
                <div style="font-size:13px;font-weight:600;margin-bottom:3px;">3 Posts para Redes</div>
                <div style="font-size:12px;color:var(--muted);line-height:1.5;">Instagram y Facebook con emojis y hashtags en espa√±ol</div>
              </div>
            </div>
            <div style="display:flex;gap:12px;">
              <div style="font-size:20px;">üìß</div>
              <div>
                <div style="font-size:13px;font-weight:600;margin-bottom:3px;">Email de Marketing</div>
                <div style="font-size:12px;color:var(--muted);line-height:1.5;">Con asunto y cuerpo listos para enviar a tu lista</div>
              </div>
            </div>
            <div style="display:flex;gap:12px;">
              <div style="font-size:20px;">üé¨</div>
              <div>
                <div style="font-size:13px;font-weight:600;margin-bottom:3px;">Script para Video</div>
                <div style="font-size:12px;color:var(--muted);line-height:1.5;">Gui√≥n de 60-90 segundos para Reels o YouTube</div>
              </div>
            </div>
          </div>
          <div style="margin-top:20px;padding:14px;background:var(--gold-dim);border:1px solid rgba(201,168,76,0.2);border-radius:9px;">
            <div style="font-size:11px;font-weight:700;color:var(--gold);margin-bottom:4px;text-transform:uppercase;letter-spacing:0.5px;">üí° Consejo Pro</div>
            <div style="font-size:12px;color:var(--muted);line-height:1.5;">Agrega detalles √∫nicos en "Caracter√≠sticas especiales" para obtener contenido m√°s personalizado y persuasivo.</div>
          </div>
        </div>

        <!-- OUTPUT -->
        <div class="output-wrap" id="outputWrap">
          <div style="display:flex;align-items:center;gap:12px;margin-bottom:20px;">
            <div style="font-size:15px;font-weight:600;">‚úÖ Contenido generado exitosamente</div>
            <div style="font-size:12px;color:var(--muted);background:var(--surface);border:1px solid var(--border);padding:4px 12px;border-radius:20px;" id="outputPropTitle"></div>
          </div>
          <div class="output-tabs">
            <button class="otab active" onclick="showOTab('mls',this)">üìù MLS</button>
            <button class="otab" onclick="showOTab('posts',this)">üì± Redes</button>
            <button class="otab" onclick="showOTab('email',this)">üìß Email</button>
            <button class="otab" onclick="showOTab('video',this)">üé¨ Video</button>
          </div>
          <div class="otab-content active" id="otab-mls">
            <div class="output-card">
              <div class="output-header">
                <div class="output-label">Descripci√≥n MLS</div>
                <button class="btn-copy" onclick="copyOut('outMls',this)">üìã Copiar</button>
              </div>
              <div class="output-text" id="outMls"></div>
            </div>
          </div>
          <div class="otab-content" id="otab-posts">
            <div class="output-card">
              <div class="output-header">
                <div class="output-label">Posts para Redes Sociales</div>
                <button class="btn-copy" onclick="copyAllPosts(this)">üìã Copiar todos</button>
              </div>
              <div id="postsContainer"></div>
            </div>
          </div>
          <div class="otab-content" id="otab-email">
            <div class="output-card">
              <div class="output-header">
                <div class="output-label">Email de Marketing</div>
                <button class="btn-copy" onclick="copyOut('outEmail',this)">üìã Copiar</button>
              </div>
              <div class="output-text" id="outEmail"></div>
            </div>
          </div>
          <div class="otab-content" id="otab-video">
            <div class="output-card">
              <div class="output-header">
                <div class="output-label">Script para Video</div>
                <button class="btn-copy" onclick="copyOut('outVideo',this)">üìã Copiar</button>
              </div>
              <div class="output-text" id="outVideo"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ PLANS PANEL ‚îÄ‚îÄ -->
    <div class="panel" id="panel-plans">
      <div style="margin-bottom:28px;">
        <div style="font-family:'Playfair Display',serif;font-size:28px;font-weight:700;margin-bottom:8px;">Elige tu Plan</div>
        <div style="color:var(--muted);font-size:14px;">Empieza gratis. Mejora cuando est√©s listo.</div>
      </div>
      <div class="plans-grid">
        <!-- FREE -->
        <div class="plan-card current" id="planCardFree">
          <div class="plan-badge gold-badge">Tu Plan Actual</div>
          <div class="plan-name">Gratis</div>
          <div class="plan-price">$0<span>/mes</span></div>
          <div class="plan-desc">Para comenzar a explorar PropIA</div>
          <div class="plan-features">
            <div class="plan-feat"><span class="check">‚úì</span> 5 listings / mes</div>
            <div class="plan-feat"><span class="check">‚úì</span> 20 leads / mes</div>
            <div class="plan-feat"><span class="check">‚úì</span> 1 agente</div>
            <div class="plan-feat"><span class="cross">‚úó</span> Dashboard broker</div>
            <div class="plan-feat"><span class="cross">‚úó</span> Historial completo</div>
          </div>
          <div class="btn-plan current">Plan Actual</div>
        </div>
        <!-- BASIC -->
        <div class="plan-card" id="planCardBasic">
          <div class="plan-name">B√°sico</div>
          <div class="plan-price">$49<span>/mes</span></div>
          <div class="plan-desc">Para el agente activo que necesita producir m√°s</div>
          <div class="plan-features">
            <div class="plan-feat"><span class="check">‚úì</span> 50 listings / mes</div>
            <div class="plan-feat"><span class="check">‚úì</span> 200 leads / mes</div>
            <div class="plan-feat"><span class="check">‚úì</span> 3 agentes</div>
            <div class="plan-feat"><span class="check">‚úì</span> Historial completo</div>
            <div class="plan-feat"><span class="cross">‚úó</span> Dashboard broker</div>
          </div>
          <div class="btn-plan upgrade-btn" onclick="upgradePlan('basic')">Mejorar a B√°sico</div>
        </div>
        <!-- PRO -->
        <div class="plan-card popular" id="planCardPro">
          <div class="plan-badge blue-badge">‚≠ê M√°s Popular</div>
          <div class="plan-name">Pro</div>
          <div class="plan-price">$149<span>/mes</span></div>
          <div class="plan-desc">Para brokerages en crecimiento</div>
          <div class="plan-features">
            <div class="plan-feat"><span class="check">‚úì</span> 200 listings / mes</div>
            <div class="plan-feat"><span class="check">‚úì</span> 1,000 leads / mes</div>
            <div class="plan-feat"><span class="check">‚úì</span> 10 agentes</div>
            <div class="plan-feat"><span class="check">‚úì</span> Dashboard broker</div>
            <div class="plan-feat"><span class="check">‚úì</span> Reportes avanzados</div>
          </div>
          <div class="btn-plan upgrade-btn" onclick="upgradePlan('pro')">Mejorar a Pro</div>
        </div>
        <!-- ENTERPRISE -->
        <div class="plan-card" id="planCardEnterprise">
          <div class="plan-name">Empresarial</div>
          <div class="plan-price">$399<span>/mes</span></div>
          <div class="plan-desc">Para grandes brokerages con equipo completo</div>
          <div class="plan-features">
            <div class="plan-feat"><span class="check">‚úì</span> Listings ilimitados</div>
            <div class="plan-feat"><span class="check">‚úì</span> Leads ilimitados</div>
            <div class="plan-feat"><span class="check">‚úì</span> Agentes ilimitados</div>
            <div class="plan-feat"><span class="check">‚úì</span> White label</div>
            <div class="plan-feat"><span class="check">‚úì</span> Soporte dedicado</div>
          </div>
          <div class="btn-plan upgrade-btn" onclick="upgradePlan('enterprise')">Contactar Ventas</div>
        </div>
      </div>
    </div>

  </div><!-- end content -->
</div><!-- end main -->

<script>
  // ‚îÄ‚îÄ AUTH CHECK ‚îÄ‚îÄ
  const token = localStorage.getItem('propia_token');
  const userRaw = localStorage.getItem('propia_user');
  if (!token) { window.location.href = '/'; }

  let user = {};
  try { user = JSON.parse(userRaw) || {}; } catch { user = {}; }

  let selectedTone = 'lujoso';
  let usageData = { listings: { used: 0, limit: 5 }, plan: 'free', planLabel: 'Gratis' };
  let historyData = [];

  // ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
  document.addEventListener('DOMContentLoaded', () => {
    setUserUI();
    loadUsage();
  });

  function setUserUI() {
    const name = user.name || user.email || 'Agente';
    const initial = name.charAt(0).toUpperCase();
    document.getElementById('userInitial').textContent = initial;
    document.getElementById('userName').textContent = name;
    document.getElementById('userPlan').textContent = (user.plan || 'free').toUpperCase();
  }

  async function loadUsage() {
    try {
      const res = await fetch('/api/usage', {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      if (res.status === 401) { logout(); return; }
      const data = await res.json();
      if (data.plan) {
        usageData = data;
        updateUsageUI();
      }
    } catch { /* silent */ }
  }

  function updateUsageUI() {
    const { listings, plan, planLabel } = usageData;
    const pct = Math.min((listings.used / listings.limit) * 100, 100);

    document.getElementById('statUsed').textContent = listings.used;
    document.getElementById('statLimit').textContent = `de ${listings.limit} en tu plan ${planLabel}`;
    document.getElementById('statProgress').style.width = pct + '%';
    document.getElementById('statPlan').textContent = planLabel;
    document.getElementById('statAssets').textContent = listings.used * 4;

    document.getElementById('topUsed').textContent = listings.used;
    document.getElementById('topLimit').textContent = listings.limit;
    document.getElementById('topPlan').textContent = planLabel;
    document.getElementById('userPlan').textContent = plan.toUpperCase();

    // Highlight current plan card
    ['free','basic','pro','enterprise'].forEach(p => {
      const card = document.getElementById('planCard' + p.charAt(0).toUpperCase() + p.slice(1));
      const btn = card?.querySelector('.btn-plan');
      if (p === plan) {
        card?.classList.add('current');
        if (btn) { btn.className = 'btn-plan current'; btn.textContent = 'Plan Actual'; }
      }
    });
  }

  // ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ
  function showPanel(name, btn) {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
    document.getElementById('panel-' + name).classList.add('active');
    btn.classList.add('active');
    const titles = { overview: 'Resumen', generator: 'Generar Listing', plans: 'Planes y Precios' };
    document.getElementById('pageTitle').textContent = titles[name] || '';
  }

  function setTone(btn, tone) {
    document.querySelectorAll('.tone-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    selectedTone = tone;
  }

  // ‚îÄ‚îÄ GENERATE ‚îÄ‚îÄ
  async function generateListing() {
    const address = document.getElementById('gAddress').value.trim();
    const price = document.getElementById('gPrice').value.trim();

    if (!address || !price) {
      setAlert('genAlert', 'Por favor ingresa la direcci√≥n y el precio.', 'error');
      return;
    }

    clearAlert('genAlert');
    const btn = document.getElementById('genBtn');
    setLoading(btn, true);

    try {
      const res = await fetch('/api/generate', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({
          address, price,
          type: document.getElementById('gType').value,
          beds: document.getElementById('gBeds').value,
          baths: document.getElementById('gBaths').value,
          sqft: document.getElementById('gSqft').value,
          year: document.getElementById('gYear').value,
          features: document.getElementById('gFeatures').value,
          tone: selectedTone
        })
      });

      const data = await res.json();

      if (res.status === 401) { logout(); return; }

      if (!res.ok || !data.success) {
        const type = data.upgrade ? 'upgrade' : 'error';
        const msg = data.upgrade
          ? `‚ö†Ô∏è ${data.error} <br><br>Mejora tu plan para continuar generando listings.`
          : (data.error || 'Error al generar el contenido.');
        setAlert('genAlert', msg, type);
        return;
      }

      displayOutput(data.content, address, price);
      usageData.listings.used = data.usage.used;
      updateUsageUI();

      // Add to history
      historyData.unshift({ address, price, tone: selectedTone, date: new Date() });
      renderHistory();

    } catch {
      setAlert('genAlert', 'Error de conexi√≥n. Intenta de nuevo.', 'error');
    } finally {
      setLoading(btn, false);
    }
  }

  function displayOutput(content, address, price) {
    document.getElementById('outputPropTitle').textContent = `${address} ¬∑ ${price}`;
    document.getElementById('outMls').textContent = content.mls || '';
    document.getElementById('outEmail').textContent = content.email || '';
    document.getElementById('outVideo').textContent = content.video || '';

    const container = document.getElementById('postsContainer');
    container.innerHTML = '';
    const labels = ['Post 1 ‚Äî Presentaci√≥n', 'Post 2 ‚Äî Caracter√≠sticas', 'Post 3 ‚Äî Llamada a la Acci√≥n'];
    (content.posts || []).forEach((p, i) => {
      container.innerHTML += `
        <div class="post-item">
          <div class="post-num">${labels[i] || 'Post ' + (i+1)}</div>
          <div class="post-text">${p}</div>
          <button class="post-copy" onclick="copyPostItem(this,${i})">üìã</button>
        </div>`;
    });

    const wrap = document.getElementById('outputWrap');
    wrap.classList.add('visible');
    showOTab('mls', document.querySelector('.otab'));
    wrap.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  function renderHistory() {
    const body = document.getElementById('historyBody');
    if (historyData.length === 0) {
      body.innerHTML = '<div class="empty-state">A√∫n no has generado ning√∫n listing.<br><span style="color:var(--gold);cursor:pointer;" onclick="showPanel(\'generator\', document.querySelectorAll(\'.nav-item\')[1])">Genera tu primer listing ‚Üí</span></div>';
      return;
    }
    body.innerHTML = historyData.map(h => `
      <div class="table-row">
        <div>
          <div style="font-size:13px;font-weight:500;">${h.address}</div>
          <div style="font-size:12px;color:var(--muted);">${h.price}</div>
        </div>
        <div><span class="tag tag-gold">${h.tone}</span></div>
        <div style="font-size:12px;color:var(--muted);">${formatDate(h.date)}</div>
      </div>`).join('');
  }

  function formatDate(d) {
    return new Intl.DateTimeFormat('es-MX', { day:'2-digit', month:'short', hour:'2-digit', minute:'2-digit' }).format(d);
  }

  // ‚îÄ‚îÄ OUTPUT TABS ‚îÄ‚îÄ
  function showOTab(name, btn) {
    document.querySelectorAll('.otab-content').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.otab').forEach(b => b.classList.remove('active'));
    document.getElementById('otab-' + name).classList.add('active');
    btn.classList.add('active');
  }

  // ‚îÄ‚îÄ COPY ‚îÄ‚îÄ
  function copyOut(id, btn) {
    navigator.clipboard.writeText(document.getElementById(id)?.textContent || '').then(() => {
      btn.textContent = '‚úì Copiado'; btn.classList.add('copied');
      setTimeout(() => { btn.textContent = 'üìã Copiar'; btn.classList.remove('copied'); }, 2000);
    });
  }

  function copyAllPosts(btn) {
    const text = [...document.querySelectorAll('.post-text')].map((el, i) => `POST ${i+1}:\n${el.textContent}`).join('\n\n');
    navigator.clipboard.writeText(text).then(() => {
      btn.textContent = '‚úì Copiado'; btn.classList.add('copied');
      setTimeout(() => { btn.textContent = 'üìã Copiar todos'; btn.classList.remove('copied'); }, 2000);
    });
  }

  function copyPostItem(btn, idx) {
    const posts = document.querySelectorAll('.post-text');
    navigator.clipboard.writeText(posts[idx]?.textContent || '').then(() => {
      btn.textContent = '‚úì'; setTimeout(() => btn.textContent = 'üìã', 2000);
    });
  }

  // ‚îÄ‚îÄ PLANS ‚îÄ‚îÄ
  function upgradePlan(plan) {
    alert(`Para mejorar al plan ${plan.toUpperCase()}, pr√≥ximamente integraremos Stripe. Por ahora cont√°ctanos en: soporte@propia.app`);
  }

  // ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ
  function setLoading(btn, val) {
    btn.disabled = val;
    btn.classList.toggle('is-loading', val);
  }

  function setAlert(id, msg, type) {
    const el = document.getElementById(id);
    el.innerHTML = msg;
    el.className = `alert ${type}`;
  }

  function clearAlert(id) {
    const el = document.getElementById(id);
    el.className = 'alert'; el.innerHTML = '';
  }

  function logout() {
    localStorage.removeItem('propia_token');
    localStorage.removeItem('propia_user');
    window.location.href = '/';
  }
</script>
</body>
</html>
